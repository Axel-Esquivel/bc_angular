<section class="entry-page">
  <p-card *ngIf="pendingSetup && !hidePendingBanner" header="Configuracion pendiente" class="entry-card">
    <p>
      Tienes una organizacion en proceso: <strong>{{ pendingOrganizationLabel }}</strong>.
      Puedes continuar la configuracion o eliminarla.
    </p>
    <div class="actions">
      <p-button type="button" label="Continuar configuracion" (onClick)="continuePendingSetup()"></p-button>
      <p-button
        type="button"
        label="Eliminar"
        severity="danger"
        (onClick)="deletePendingSetup()"
      ></p-button>
      <p-button
        type="button"
        label="Ignorar por ahora"
        severity="secondary"
        [text]="true"
        (onClick)="hidePending()"
      ></p-button>
    </div>
  </p-card>

  <p-card header="Configura tu organizacion" class="entry-card">
    <p>Elige como quieres comenzar.</p>
    <div class="actions">
      <p-button type="button" label="Crear organizacion" (onClick)="goCreate()"></p-button>
      <p-button type="button" label="Unirme" severity="secondary" (onClick)="goJoin()"></p-button>
    </div>
  </p-card>

  <p-card header="Organizaciones (Owner)" class="entry-card">
    <p class="state" *ngIf="loading">Cargando organizaciones...</p>
    <p class="state" *ngIf="!loading && ownerOrganizations.length === 0">
      No tienes organizaciones como owner.
    </p>
    <p-table
      *ngIf="!loading && ownerOrganizations.length > 0"
      [value]="ownerOrganizations"
      [paginator]="false"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Nombre</th>
          <th>Pais</th>
          <th>Moneda</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-org>
        <tr>
          <td>{{ org.name }}</td>
          <td>{{ getCountryLabel(org) }}</td>
          <td>{{ getCurrencyLabel(org) }}</td>
          <td>
            <div class="actions">
              <p-button type="button" label="Editar" size="small" (onClick)="openEdit(org)"></p-button>
              <p-button
                type="button"
                label="Default"
                size="small"
                severity="secondary"
                (onClick)="setDefault(org)"
              ></p-button>
              <p-button
                type="button"
                label="Eliminar"
                size="small"
                severity="danger"
                (onClick)="deleteOrganization(org)"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-card header="Membresias activas" class="entry-card">
    <p class="state" *ngIf="!loading && activeMemberships.length === 0">Sin membresias activas.</p>
    <p-table
      *ngIf="activeMemberships.length > 0"
      [value]="activeMemberships"
      [paginator]="false"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Organizacion</th>
          <th>Rol</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.roleKey }}</td>
          <td>Activo</td>
          <td>
            <div class="actions">
              <p-button
                type="button"
                label="Salir"
                size="small"
                severity="secondary"
                (onClick)="leaveOrganization(item)"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-card header="Membresias pendientes" class="entry-card">
    <p class="state" *ngIf="!loading && pendingMemberships.length === 0">Sin membresias pendientes.</p>
    <p-table
      *ngIf="pendingMemberships.length > 0"
      [value]="pendingMemberships"
      [paginator]="false"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Organizacion</th>
          <th>Rol</th>
          <th>Estado</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.roleKey }}</td>
          <td>Pendiente</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-card header="Membresias rechazadas" class="entry-card">
    <p class="state" *ngIf="!loading && rejectedMemberships.length === 0">Sin membresias rechazadas.</p>
    <p-table
      *ngIf="rejectedMemberships.length > 0"
      [value]="rejectedMemberships"
      [paginator]="false"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Organizacion</th>
          <th>Rol</th>
          <th>Estado</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.roleKey }}</td>
          <td>Rechazado</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <p-card *ngIf="!loading && isEmpty" class="entry-card">
    <p class="state">No hay organizaciones ni membresias.</p>
  </p-card>
</section>

<p-dialog
  header="Configurar organizacion"
  [(visible)]="wizardDialogOpen"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [style]="{ width: 'min(1000px, 95vw)', maxHeight: '90vh' }"
  [contentStyle]="{ overflow: 'auto', maxHeight: 'calc(90vh - 8rem)', padding: '0' }"
  (onHide)="onWizardCancelled()"
>
  <app-org-create-page
    [organizationId]="wizardOrganizationId || undefined"
    [startStep]="wizardStartStep"
    [managePending]="false"
    [navigateOnComplete]="false"
    [visibleInDialog]="true"
    mode="dialog"
    (cancelled)="onWizardCancelled()"
    (completed)="onWizardCompleted($event)"
    (organizationCreated)="onWizardOrganizationCreated($event)"
    (stepChanged)="onWizardStepChanged($event)"
  ></app-org-create-page>
</p-dialog>

<p-dialog
  header="Editar organizacion"
  [(visible)]="editDialogOpen"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [style]="{ width: '420px' }"
>
  <div class="bc-form">
    <div class="bc-field">
      <p-floatLabel>
        <input id="editOrgName" type="text" pInputText [(ngModel)]="editOrganizationName" class="w-full" />
        <label for="editOrgName">Nombre</label>
      </p-floatLabel>
    </div>
  </div>
  <ng-template #footer>
    <div class="bc-actions bc-actions--end">
      <p-button label="Cancelar" severity="secondary" (onClick)="closeEdit()"></p-button>
      <p-button label="Guardar" icon="pi pi-check" (onClick)="saveEdit()"></p-button>
    </div>
  </ng-template>
</p-dialog>
