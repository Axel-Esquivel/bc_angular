<p-toast></p-toast>
<section class="bc-page-center">
  <p-card header="Crear organizacion" class="bc-card">
    <form [formGroup]="form" (ngSubmit)="submit()" class="bc-form">
      <div class="bc-field-group">
        <div class="bc-field">
          <p-floatLabel>
            <input id="orgName" type="text" pInputText formControlName="name" class="w-full" />
            <label for="orgName">Organizacion</label>
          </p-floatLabel>
        </div>
        <small class="bc-error" *ngIf="form.controls.name.invalid && form.controls.name.touched">
          Ingresa un nombre valido.
        </small>
      </div>

      <p-divider></p-divider>

      <div class="bc-field-group">
        <div class="bc-field">
          <p-floatLabel>
            <p-select
              inputId="countryId"
              [options]="countries"
              optionLabel="name"
              optionValue="id"
              class="w-full"
              styleClass="w-full"
              formControlName="countryId"
            >
              <ng-template #selectedItem let-country>
                <div class="select-item">
                  <i class="pi pi-map-marker"></i>
                  <span>{{ country?.name }} ({{ country?.code?.toUpperCase() }})</span>
                </div>
              </ng-template>
              <ng-template #item let-country>
                <div class="select-item">
                  <i class="pi pi-flag"></i>
                  <span>{{ country.name }} ({{ country.code?.toUpperCase() }})</span>
                </div>
              </ng-template>
              <ng-template #dropdownicon>
                <i class="pi pi-chevron-down"></i>
              </ng-template>
              <ng-template #footer>
                <div class="p-3 pt-2 w-full">
                  <p-button
                    label="Agregar"
                    icon="pi pi-plus"
                    severity="secondary"
                    text
                    size="small"
                    [fluid]="true"
                    styleClass="w-full"
                    (onClick)="openCreateCountryDialog()"
                  />
                </div>
              </ng-template>
            </p-select>
            <label for="countryId">Pais</label>
          </p-floatLabel>
        </div>
        <small class="bc-hint" *ngIf="countries.length === 0">No hay paises creados, agrega uno nuevo.</small>
      </div>

      <div class="bc-field-group">
        <div class="bc-field">
          <p-floatLabel>
            <p-select
              inputId="currencyId"
              [options]="currencies"
              optionLabel="name"
              optionValue="id"
              class="w-full"
              styleClass="w-full"
              formControlName="currencyId"
            >
              <ng-template #selectedItem let-currency>
                <div class="select-item">
                  <i class="pi pi-wallet"></i>
                  <span>{{ currency?.name }} ({{ currency?.symbol || currency?.code }})</span>
                </div>
              </ng-template>
              <ng-template #item let-currency>
                <div class="select-item">
                  <i class="pi pi-money-bill"></i>
                  <span>{{ currency.name }} ({{ currency.symbol || currency.code }})</span>
                </div>
              </ng-template>
              <ng-template #dropdownicon>
                <i class="pi pi-chevron-down"></i>
              </ng-template>
              <ng-template #footer>
                <div class="p-3 pt-2 w-full">
                  <p-button
                    label="Agregar"
                    icon="pi pi-plus"
                    severity="secondary"
                    text
                    size="small"
                    [fluid]="true"
                    styleClass="w-full"
                    (onClick)="openCreateCurrencyDialog()"
                  />
                </div>
              </ng-template>
            </p-select>
            <label for="currencyId">Moneda</label>
          </p-floatLabel>
        </div>
        <small class="bc-hint" *ngIf="currencies.length === 0">No hay monedas creadas, agrega una nueva.</small>
      </div>

      <div class="bc-actions">
        <p-button
          type="submit"
          label="Crear organizacion"
          [disabled]="form.controls.name.invalid || isSubmitting || countries.length === 0 || currencies.length === 0"
          [fluid]="true"
          styleClass="w-full"
        ></p-button>
        <small class="bc-error" *ngIf="countries.length === 0">
          Debes crear al menos un pais antes de crear la organizacion.
        </small>
        <small class="bc-error" *ngIf="currencies.length === 0">
          Debes crear al menos una moneda antes de crear la organizacion.
        </small>
      </div>
    </form>
  </p-card>
</section>

<p-dialog
  header="Nuevo pais"
  [(visible)]="isCountryDialogOpen"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [style]="{ width: '420px' }"
>
  <app-create-country-form
    #countryForm
    [showActions]="false"
    (created)="onCountryCreated($event); isCountryDialogOpen = false"
    (cancelled)="isCountryDialogOpen = false"
    (error)="onDialogError($event)"
  ></app-create-country-form>
  <ng-template #footer>
    <div class="bc-actions bc-actions--end">
      <p-button label="Cancelar" severity="secondary" (onClick)="countryForm.cancel()"></p-button>
      <p-button label="Crear" icon="pi pi-check" (onClick)="countryForm.submit()"></p-button>
    </div>
  </ng-template>
</p-dialog>

<p-dialog
  header="Nueva moneda"
  [(visible)]="isCurrencyDialogOpen"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [style]="{ width: '420px' }"
>
  <app-create-currency-form
    #currencyForm
    [showActions]="false"
    (created)="onCurrencyCreated($event); isCurrencyDialogOpen = false"
    (cancelled)="isCurrencyDialogOpen = false"
    (error)="onDialogError($event)"
  ></app-create-currency-form>
  <ng-template #footer>
    <div class="bc-actions bc-actions--end">
      <p-button label="Cancelar" severity="secondary" (onClick)="currencyForm.cancel()"></p-button>
      <p-button label="Crear" icon="pi pi-check" (onClick)="currencyForm.submit()"></p-button>
    </div>
  </ng-template>
</p-dialog>
