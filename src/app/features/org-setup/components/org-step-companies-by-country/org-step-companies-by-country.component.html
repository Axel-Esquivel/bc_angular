<div class="bc-step-panel">
  <div class="bc-alerts" *ngIf="!hasOrganization">
    <div class="bc-alert bc-alert--info">
      <div class="bc-alert__icon">
        <i class="pi pi-info-circle" aria-hidden="true"></i>
      </div>
      <div class="bc-alert__content">
        <div class="bc-alert__title">Primero crea la organizacion</div>
        <div class="bc-alert__text">Completa el paso anterior para habilitar esta seccion.</div>
      </div>
    </div>
  </div>

  <div class="bc-alerts" *ngIf="hasOrganization && companies.length === 0">
    <div class="bc-alert bc-alert--warn">
      <div class="bc-alert__icon">
        <i class="pi pi-exclamation-triangle" aria-hidden="true"></i>
      </div>
      <div class="bc-alert__content">
        <div class="bc-alert__title">Faltan companias</div>
        <div class="bc-alert__text">Agrega al menos una compania para continuar.</div>
      </div>
      <div class="bc-alert__action">
        <p-button
          label="Crear compania"
          icon="pi pi-plus"
          severity="secondary"
          text
          size="small"
          (onClick)="openCreateCompanyDialog()"
        />
      </div>
    </div>
  </div>

  <div class="bc-panel-header">
    <h3>Filtrar por pais</h3>
  </div>
  <p-select
    inputId="countryFilter"
    [options]="countries"
    optionLabel="name"
    optionValue="id"
    class="w-full"
    styleClass="w-full"
    [formControl]="countryFilterControl"
  >
    <ng-template #selectedItem let-country>
      <div class="select-item">
        <i class="pi pi-flag"></i>
        <span>{{ country?.name }}</span>
      </div>
    </ng-template>
    <ng-template #item let-country>
      <div class="select-item">
        <i class="pi pi-flag"></i>
        <span>{{ country.name }}</span>
      </div>
    </ng-template>
    <ng-template #dropdownicon>
      <i class="pi pi-chevron-down"></i>
    </ng-template>
  </p-select>

  <div class="bc-panel-header bc-panel-header--spaced">
    <h3>Companias</h3>
    <p-button
      label="Agregar compania"
      icon="pi pi-plus"
      severity="secondary"
      text
      size="small"
      [disabled]="!hasOrganization"
      (onClick)="openCreateCompanyDialog()"
    />
  </div>
  <div class="bc-list" *ngIf="filteredCompanies.length > 0; else emptyCompanies">
  <div class="bc-list-item" *ngFor="let company of filteredCompanies">
    <div class="bc-list-item__content">
      <div class="bc-list-item__title">{{ company.name }}</div>
      <div class="bc-list-item__meta">
        <span>{{ getCompanyCountryLabel(company) }}</span>
        <span>{{ getCompanyCurrencyLabel(company) }}</span>
      </div>
    </div>
    <div class="bc-actions">
      <p-button
        icon="pi pi-pencil"
        text
        size="small"
        (onClick)="editCompany.emit(company)"
      ></p-button>
      <p-button
        icon="pi pi-trash"
        severity="danger"
        text
        size="small"
        (onClick)="deleteCompany.emit(company)"
      ></p-button>
    </div>
  </div>
</div>
  <ng-template #emptyCompanies>
    <div class="bc-empty">No hay companias para el pais seleccionado.</div>
  </ng-template>
</div>

<p-dialog
  header="Nueva compania"
  [(visible)]="isCompanyDialogOpen"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [style]="{ width: '420px' }"
>
  <form [formGroup]="companyForm" class="bc-form">
    <div class="bc-field-group">
      <div class="bc-field">
        <p-floatLabel>
          <input id="companyName" type="text" pInputText formControlName="name" class="w-full" />
          <label for="companyName">Nombre de compania</label>
        </p-floatLabel>
      </div>
    </div>

    <div class="bc-field-group">
      <div class="bc-field">
        <p-floatLabel>
          <p-select
            inputId="companyCountry"
            [options]="countries"
            optionLabel="name"
            optionValue="id"
            class="w-full"
            styleClass="w-full"
            formControlName="countryId"
          ></p-select>
          <label for="companyCountry">Pais base</label>
        </p-floatLabel>
      </div>
    </div>

    <div class="bc-field-group">
      <div class="bc-field">
        <p-floatLabel>
          <p-select
            inputId="companyCurrency"
            [options]="currencies"
            optionLabel="name"
            optionValue="id"
            class="w-full"
            styleClass="w-full"
            formControlName="currencyId"
          ></p-select>
          <label for="companyCurrency">Moneda base</label>
        </p-floatLabel>
      </div>
    </div>
  </form>
  <ng-template #footer>
    <div class="bc-actions bc-actions--end">
      <p-button label="Cancelar" severity="secondary" (onClick)="isCompanyDialogOpen = false"></p-button>
      <p-button label="Crear" icon="pi pi-check" [loading]="isSubmittingCompany" (onClick)="submitCompany()"></p-button>
    </div>
  </ng-template>
</p-dialog>
