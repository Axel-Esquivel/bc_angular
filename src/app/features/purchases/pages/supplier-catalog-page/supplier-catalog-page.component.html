<p-toolbar>
  <ng-template pTemplate="start">
    <div class="toolbar-title">
      <span>Cat&aacute;logo proveedor-producto</span>
    </div>
  </ng-template>
  <ng-template pTemplate="end">
    <div class="toolbar-actions">
      <p-select
        inputId="supplierId"
        [options]="providerOptions"
        optionLabel="label"
        optionValue="value"
        [(ngModel)]="selectedProviderId"
        (onChange)="onProviderChange()"
        [disabled]="providerOptions.length === 0"
        placeholder="Proveedor"
      ></p-select>
      <p-button
        label="Nuevo"
        icon="pi pi-plus"
        (onClick)="openCreate()"
        [disabled]="providerOptions.length === 0"
      ></p-button>
    </div>
  </ng-template>
</p-toolbar>

<div class="messages">
  <p-message
    *ngIf="!contextMissing && providerOptions.length === 0"
    severity="warn"
    text="No hay proveedores. Crea uno para poder registrar precios."
  ></p-message>
  <p-button
    *ngIf="!contextMissing && providerOptions.length === 0"
    label="Ir a proveedores"
    icon="pi pi-arrow-right"
    severity="secondary"
    text="true"
    (onClick)="navigateToProviders()"
  ></p-button>
  <p-message
    *ngIf="!contextMissing && providerOptions.length > 0 && !selectedProviderId"
    severity="info"
    text="Selecciona un proveedor para ver sus productos."
  ></p-message>
</div>

<div class="catalog-table">
  <p-table [value]="rows" [loading]="loading" dataKey="variantId" [rows]="20" [paginator]="rows.length > 20">
    <ng-template pTemplate="header">
      <tr>
        <th>Variante</th>
        <th>Costo sugerido</th>
        <th>Moneda</th>
        <th>Flete</th>
        <th>Tipo bono</th>
        <th>Valor bono</th>
        <th>Min qty</th>
        <th>Lead time</th>
        <th>Estado</th>
        <th class="actions">Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-row>
      <tr>
        <td>{{ row.variantLabel }}</td>
        <td>{{ row.unitCost ?? '—' }}</td>
        <td>{{ row.currency || '—' }}</td>
        <td>{{ row.freightCost ?? '—' }}</td>
        <td>{{ row.bonusType || 'none' }}</td>
        <td>{{ row.bonusValue ?? '—' }}</td>
        <td>{{ row.minQty ?? '—' }}</td>
        <td>{{ row.leadTimeDays ?? '—' }}</td>
        <td>{{ resolveStatusLabel(row.status) }}</td>
        <td class="actions">
          <p-button
            icon="pi pi-pencil"
            label="Editar"
            size="small"
            severity="secondary"
            (onClick)="openEdit(row)"
          ></p-button>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="10">
          {{ contextMissing ? 'Selecciona organizaci&oacute;n y empresa.' : 'Sin datos para el proveedor seleccionado.' }}
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog
  [header]="editingOverrideId ? 'Editar \u00edtem' : 'Nuevo \u00edtem'"
  [(visible)]="dialogVisible"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [style]="{ width: '560px' }"
>
  <app-supplier-catalog-form
    [item]="editingItem ?? undefined"
    [variantOptions]="variantOptions"
    (save)="onFormSave($event)"
    (cancel)="closeDialog()"
  ></app-supplier-catalog-form>
</p-dialog>
