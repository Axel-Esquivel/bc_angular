<div class="lines-accordion" [formGroup]="form">
  <div formArrayName="lines">
    <p-accordion [multiple]="true" [activeIndex]="[0]">
      <p-accordionTab *ngFor="let group of formArray.controls; let i = index">
        <ng-template pTemplate="header">
          <div class="line-header">
            <div class="line-title">
              {{ getLineVariantLabel(i) }}
            </div>
            <div class="line-summary">
              <span>Qty: {{ getLineQty(i) }}</span>
              <span>Total: {{ getLineTotal(i) | number:'1.2-2' }}</span>
            </div>
          </div>
        </ng-template>

        <div class="line-body" [formGroupName]="i">
          <div class="line-fields">
            <div class="field">
              <label for="qty-{{ i }}">Cantidad</label>
              <p-inputNumber
                inputId="qty-{{ i }}"
                formControlName="qty"
                [min]="0"
                [minFractionDigits]="0"
                [maxFractionDigits]="2"
              ></p-inputNumber>
            </div>
            <div class="field">
              <label for="unitCost-{{ i }}">Precio / costo</label>
              <p-inputNumber
                inputId="unitCost-{{ i }}"
                formControlName="unitCost"
                [min]="0"
                [minFractionDigits]="2"
                [maxFractionDigits]="2"
              ></p-inputNumber>
            </div>
            <div class="field">
              <label for="currency-{{ i }}">Moneda</label>
              <input pInputText [id]="'currency-' + i" formControlName="currency" />
            </div>
            <div class="field">
              <label for="freight-{{ i }}">Flete</label>
              <p-inputNumber
                inputId="freight-{{ i }}"
                formControlName="freightCost"
                [min]="0"
                [minFractionDigits]="2"
                [maxFractionDigits]="2"
              ></p-inputNumber>
            </div>
            <div class="field">
              <label for="extra-{{ i }}">Gastos extra</label>
              <p-inputNumber
                inputId="extra-{{ i }}"
                formControlName="extraCosts"
                [min]="0"
                [minFractionDigits]="2"
                [maxFractionDigits]="2"
              ></p-inputNumber>
            </div>
            <div class="field full">
              <label for="notes-{{ i }}">Observaci&oacute;n</label>
              <input pInputText [id]="'notes-' + i" formControlName="notes" />
            </div>
          </div>
          <div class="line-actions">
            <p-button
              label="Quitar"
              icon="pi pi-trash"
              severity="danger"
              (onClick)="onRemove(i)"
            ></p-button>
          </div>
        </div>
      </p-accordionTab>
    </p-accordion>
  </div>
</div>
