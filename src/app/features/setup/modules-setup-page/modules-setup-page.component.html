<p-toast></p-toast>

<div class="modules-setup-page">
  <p-card header="Selector de modulos" subheader="Activa los modulos que estaran disponibles en el sistema.">
    <ng-template pTemplate="content">
      <div class="modules-grid" *ngIf="modules.length > 0; else emptyState">
        <p-card *ngFor="let module of modules" class="module-card">
          <ng-template pTemplate="title">
            <div class="card-title">
              <span>{{ module.name }}</span>
              <span class="version">v{{ module.version }}</span>
            </div>
          </ng-template>
          <ng-template pTemplate="subtitle">
            <span *ngIf="module.description; else noDescription">{{ module.description }}</span>
            <ng-template #noDescription>Sin descripcion</ng-template>
          </ng-template>
          <ng-template pTemplate="content">
            <div class="module-meta">
              <span class="meta-label">Dependencias</span>
              <span class="meta-value" *ngIf="module.dependencies?.length; else noDependencies">
                {{ module.dependencies.join(', ') }}
              </span>
              <ng-template #noDependencies>
                <span class="meta-value muted">Sin dependencias</span>
              </ng-template>
            </div>
            <div class="module-meta" *ngIf="hasMissingDependencies(module)">
              <span class="meta-label warning">Dependencias faltantes</span>
              <span class="meta-value">{{ module.missingDependencies.join(', ') }}</span>
            </div>
          </ng-template>
          <ng-template pTemplate="footer">
            <div class="card-footer">
              <div class="toggle">
                <span class="state-label">{{ module.enabled ? 'Activo' : 'Inactivo' }}</span>
                <p-toggleswitch
                  [(ngModel)]="module.enabled"
                  [disabled]="isProcessing(module.name)"
                  (onChange)="toggleModule(module)"
                ></p-toggleswitch>
              </div>
              <span class="processing" *ngIf="isProcessing(module.name)">Guardando...</span>
            </div>
          </ng-template>
        </p-card>
      </div>
      <ng-template #emptyState>
        <div class="empty-state">
          <p>No hay modulos disponibles.</p>
        </div>
      </ng-template>
    </ng-template>
    <ng-template pTemplate="footer">
      <div class="footer-actions">
        <p-button label="Continuar al login" icon="pi pi-check" (onClick)="continueToLogin()"></p-button>
      </div>
    </ng-template>
  </p-card>
</div>
