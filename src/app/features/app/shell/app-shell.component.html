<section class="app-shell">
  <header class="app-shell__header">
    <div>
      <h1>Panel principal</h1>
      <p>Administra los modulos instalables de tu organizacion.</p>
    </div>
  </header>

  <section class="module-store">
    <div class="module-store__header">
      <div>
        <h2>Modulos</h2>
        <p>Instala funcionalidades segun las necesidades de tu negocio.</p>
      </div>
      <p-tag *ngIf="organizationId" severity="success" value="Organizacion activa"></p-tag>
    </div>

    <div class="module-store__empty" *ngIf="!organizationId">
      Selecciona una organizacion para ver los modulos instalables.
    </div>

    <div class="module-store__loading" *ngIf="organizationId && isLoading">
      Cargando modulos disponibles...
    </div>

    <div class="module-store__grid" *ngIf="organizationId && !isLoading">
      <p-card *ngFor="let module of modules" class="module-card">
        <ng-template pTemplate="header">
          <div class="module-card__header">
            <div class="module-card__title">
              <h3>{{ module.name || module.key }}</h3>
              <span class="module-card__version">v{{ module.version || '1.0.0' }}</span>
            </div>
            <p-tag [severity]="module.installed ? 'success' : 'info'" [value]="module.installed ? 'Instalado' : 'Disponible'"></p-tag>
          </div>
        </ng-template>
        <ng-template pTemplate="content">
          <p class="module-card__description" *ngIf="module.description">{{ module.description }}</p>
          <div class="module-card__meta" *ngIf="module.dependencies?.length">
            <span class="module-card__label">Dependencias</span>
            <div class="module-card__chips">
              <p-chip *ngFor="let dependency of module.dependencies" [label]="dependency"></p-chip>
            </div>
          </div>
          <div class="module-card__actions">
            <p-button
              label="Instalar"
              icon="pi pi-download"
              [disabled]="module.installed || isInstalling(module.key)"
              [loading]="isInstalling(module.key)"
              (onClick)="installModule(module)"
            ></p-button>
          </div>
        </ng-template>
      </p-card>
    </div>

    <div class="module-store__empty" *ngIf="organizationId && !isLoading && modules.length === 0">
      No hay modulos instalables disponibles.
    </div>
  </section>

  <router-outlet></router-outlet>
</section>
