<section class="pos-page">
  <header class="pos-header">
    <div>
      <p class="eyebrow">Punto de venta</p>
      <h1>POS</h1>
      <p class="muted">
        Estado: {{ sessionId ? 'Sesi\u00f3n abierta' : 'Sesi\u00f3n no iniciada' }}
      </p>
    </div>
    <div class="pos-controls">
      <p-select
        [options]="warehouseOptions"
        optionLabel="name"
        optionValue="id"
        placeholder="Selecciona almac\u00e9n"
        [(ngModel)]="selectedWarehouseId"
        [disabled]="warehouseOptions.length === 0"
      ></p-select>
      <p-button
        label="Abrir sesi\u00f3n"
        icon="pi pi-play"
        severity="success"
        [disabled]="!!sessionId || !selectedWarehouseId"
        (onClick)="openSession()"
      ></p-button>
    </div>
  </header>

  <section class="pos-layout">
    <p-card>
      <bc-pos-product-selector
        [products]="products"
        [loading]="productsLoading"
        (search)="onSearchProducts($event)"
        (addProduct)="onAddProduct($event)"
      ></bc-pos-product-selector>
    </p-card>

    <div class="pos-column">
      <p-card>
        <bc-pos-cart-lines
          [lines]="cartLines"
          (quantityChange)="onQuantityChange($event.lineId, $event.quantity)"
          (remove)="onRemoveLine($event)"
        ></bc-pos-cart-lines>
      </p-card>

      <p-card>
        <bc-pos-totals
          [total]="total"
          [itemsCount]="cartLines.length"
          (checkout)="onCheckout($event)"
        ></bc-pos-totals>
      </p-card>
    </div>
  </section>
</section>

<p-dialog
  header="Recarga"
  [(visible)]="prepaidDialogVisible"
  [modal]="true"
  [draggable]="false"
  [style]="{ width: '420px' }"
>
  <form [formGroup]="prepaidForm" class="dialog-form">
    <label for="prepaidPhone">Número de teléfono</label>
    <input id="prepaidPhone" type="text" pInputText formControlName="phoneNumber" />
    <label for="prepaidDenomination">Denominación</label>
    <p-inputNumber
      inputId="prepaidDenomination"
      formControlName="denomination"
      [min]="0"
      locale="en-US"
      [readonly]="prepaidDialogLockedDenomination"
    ></p-inputNumber>
  </form>
  <ng-template #footer>
    <div class="dialog-actions">
      <p-button label="Cancelar" severity="secondary" (onClick)="cancelPrepaidLine()"></p-button>
      <p-button label="Agregar" icon="pi pi-check" (onClick)="confirmPrepaidLine()"></p-button>
    </div>
  </ng-template>
</p-dialog>
