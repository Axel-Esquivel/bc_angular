<div class="movements-page">
  <p-card>
    <ng-template pTemplate="title">Movimientos</ng-template>
    <form class="filters" [formGroup]="filtersForm" (ngSubmit)="onApplyFilters()">
      <div class="context-info">
        Empresa activa: {{ (enterpriseName$ | async) || (enterpriseId$ | async) || '-' }}
      </div>
      <div class="filter-row">
        <div class="field">
          <label for="warehouse">Bodega</label>
          <p-select
            id="warehouse"
            [options]="warehouseOptions"
            formControlName="warehouseId"
            (onChange)="onWarehouseChange()"
            appendTo="body"
          ></p-select>
        </div>
        <div class="field">
          <label for="location">Ubicacion</label>
          <p-select
            id="location"
            [options]="locationOptions"
            formControlName="locationId"
            appendTo="body"
          ></p-select>
        </div>
        <div class="field">
          <label for="product">Producto</label>
          <p-autoComplete
            id="product"
            formControlName="productSearch"
            [suggestions]="productSuggestions"
            [optionLabel]="'name'"
            placeholder="Nombre o SKU"
            (completeMethod)="searchProducts($event)"
            (onSelect)="onProductSelect($event)"
            (onClear)="onProductClear()"
          ></p-autoComplete>
        </div>
        <div class="field">
          <label for="start">Desde</label>
          <p-datePicker id="start" formControlName="startDate"></p-datePicker>
        </div>
        <div class="field">
          <label for="end">Hasta</label>
          <p-datePicker id="end" formControlName="endDate"></p-datePicker>
        </div>
        <div class="actions">
          <p-button type="submit" label="Aplicar" icon="pi pi-filter"></p-button>
          <p-button label="Limpiar" [text]="true" (onClick)="onReset()"></p-button>
        </div>
      </div>
    </form>
  </p-card>

  <p-card>
    <p-table [value]="rows" [loading]="loading" dataKey="date">
      <ng-template pTemplate="header">
        <tr>
          <th>Fecha</th>
          <th>Tipo</th>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Desde</th>
          <th>Hasta</th>
          <th>Referencia</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-row>
        <tr>
          <td>{{ row.date | date: 'short' }}</td>
          <td>{{ row.type }}</td>
          <td>{{ row.productId }}</td>
          <td>{{ row.qty }}</td>
          <td>{{ row.from }}</td>
          <td>{{ row.to }}</td>
          <td>{{ row.reference }}</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
