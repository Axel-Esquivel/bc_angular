<p-toast></p-toast>

<section class="org-entry">
  <div class="header">
    <h1>Crear o unirse a una organizacion</h1>
    <p>Elige como quieres continuar con tu primera organizacion.</p>
  </div>

  <div class="cards">
    <p-card>
      <ng-template pTemplate="title">Crear organizacion</ng-template>
      <p>Crea una organizacion nueva para comenzar el setup.</p>
      <p-button label="Crear organizacion" icon="pi pi-plus" (onClick)="openCreateDialog()"></p-button>
    </p-card>

    <p-card>
      <ng-template pTemplate="title">Unirse a organizacion</ng-template>
      <p>Envia una solicitud de acceso con el correo y el codigo.</p>
      <form [formGroup]="joinForm" class="join-form">
        <label>Correo</label>
        <input pInputText type="email" formControlName="email" placeholder="correo@dominio.com" />

        <label>Codigo de organizacion</label>
        <input pInputText formControlName="orgCode" placeholder="ABCD-1234" />
      </form>
      <p-button
        label="Enviar solicitud"
        icon="pi pi-send"
        [disabled]="submitting"
        (onClick)="submitJoinRequest()"
      ></p-button>
    </p-card>
  </div>
</section>

<p-dialog
  header="Crear organizacion"
  [(visible)]="createDialogOpen"
  [modal]="true"
  appendTo="body"
  [style]="{ width: '420px' }"
>
  <form [formGroup]="createForm" class="dialog-form p-fluid flex flex-column gap-3">
    <label>Nombre</label>
    <input pInputText formControlName="name" />

    <label>Paises</label>
    <p-select
      class="w-full"
      [options]="countryOptions"
      optionLabel="name"
      optionValue="id"
      formControlName="countryIds"
      multiple
      [filter]="true"
      appendTo="body"
      placeholder="Seleccionar paises"
    >
      <ng-template pTemplate="footer">
        <div class="select-footer">
          <p-button
            label="Add New"
            icon="pi pi-plus"
            size="small"
            severity="secondary"
            [text]="true"
            [fluid]="true"
            (onClick)="openCreateCountryDialog()"
          ></p-button>
        </div>
      </ng-template>
    </p-select>

    <label>Monedas</label>
    <p-select
      class="w-full"
      [options]="currencyOptions"
      optionLabel="name"
      optionValue="id"
      formControlName="currencyIds"
      multiple
      [filter]="true"
      appendTo="body"
      placeholder="Seleccionar monedas"
    >
      <ng-template pTemplate="footer">
        <div class="select-footer">
          <p-button
            label="Add New"
            icon="pi pi-plus"
            size="small"
            severity="secondary"
            [text]="true"
            [fluid]="true"
            (onClick)="openCreateCurrencyDialog()"
          ></p-button>
        </div>
      </ng-template>
    </p-select>
  </form>
  <ng-template pTemplate="footer">
    <p-button label="Cancelar" [text]="true" (onClick)="createDialogOpen=false"></p-button>
    <p-button label="Crear" icon="pi pi-check" [disabled]="submitting" (onClick)="createOrganization()"></p-button>
  </ng-template>
</p-dialog>

<p-dialog header="Agregar pais" [(visible)]="createCountryDialogOpen" [modal]="true" [style]="{ width: '420px' }">
  <form [formGroup]="createCountryForm" class="dialog-form">
    <label>Codigo</label>
    <input pInputText formControlName="code" />

    <label>Nombre</label>
    <input pInputText formControlName="name" />
  </form>
  <ng-template pTemplate="footer">
    <p-button label="Cancelar" [text]="true" (onClick)="createCountryDialogOpen=false"></p-button>
    <p-button label="Guardar" icon="pi pi-check" (onClick)="saveCountry()"></p-button>
  </ng-template>
</p-dialog>

<p-dialog header="Agregar moneda" [(visible)]="createCurrencyDialogOpen" [modal]="true" [style]="{ width: '420px' }">
  <form [formGroup]="createCurrencyForm" class="dialog-form">
    <label>Codigo</label>
    <input pInputText formControlName="code" />

    <label>Nombre</label>
    <input pInputText formControlName="name" />

    <label>Simbolo</label>
    <input pInputText formControlName="symbol" />
  </form>
  <ng-template pTemplate="footer">
    <p-button label="Cancelar" [text]="true" (onClick)="createCurrencyDialogOpen=false"></p-button>
    <p-button label="Guardar" icon="pi pi-check" (onClick)="saveCurrency()"></p-button>
  </ng-template>
</p-dialog>
