<p-toast></p-toast>

<div class="organization-setup">
  <div class="page-header">
    <div>
      <h1>Core setup de organizacion</h1>
      <div class="subtitle">Configura paises, monedas y companias base.</div>
    </div>
  </div>

  <p-card>
    <ng-template pTemplate="title">Organizacion</ng-template>
    <div class="field">
      <label>Organizacion activa</label>
      <div class="organization-name">
        {{ organizationName || 'Organizacion' }}
      </div>
    </div>
  </p-card>

  <div class="setup-grid">
    <p-card>
      <ng-template pTemplate="title">Paises</ng-template>
      <div class="field">
        <label>Pais</label>
        <p-select
          class="w-full"
          [options]="coreSettings.countries"
          [(ngModel)]="selectedCountry"
          optionLabel="name"
          [showClear]="true"
          [filter]="true"
          placeholder="Seleccionar pais"
          appendTo="body"
        >
          <ng-template pTemplate="dropdownicon">
            <i class="pi pi-map-marker"></i>
          </ng-template>
          <ng-template pTemplate="header">
            <div class="select-header">Disponibles</div>
          </ng-template>
          <ng-template pTemplate="selectedItem" let-country>
            <span *ngIf="country">{{ getCountryLabel(country) }}</span>
            <span *ngIf="!country">Seleccionar pais</span>
          </ng-template>
          <ng-template pTemplate="item" let-country>
            <span>{{ getCountryLabel(country) }}</span>
          </ng-template>
          <ng-template pTemplate="footer">
            <div class="select-footer">
              <p-button
                label="Add New"
                icon="pi pi-plus"
                [text]="true"
                severity="secondary"
                [disabled]="!organizationId"
                (onClick)="openCreateCountryDialog()"
              ></p-button>
            </div>
          </ng-template>
        </p-select>
        <small class="hint" *ngIf="!loadingCoreSettings && coreSettings.countries.length === 0">
          No hay paises registrados.
        </small>
      </div>
    </p-card>

    <p-card>
      <ng-template pTemplate="title">Monedas</ng-template>
      <div class="field">
        <label>Moneda</label>
        <p-select
          class="w-full"
          [options]="coreSettings.currencies"
          [(ngModel)]="selectedCurrency"
          optionLabel="name"
          [showClear]="true"
          [filter]="true"
          placeholder="Seleccionar moneda"
          appendTo="body"
        >
          <ng-template pTemplate="dropdownicon">
            <i class="pi pi-wallet"></i>
          </ng-template>
          <ng-template pTemplate="header">
            <div class="select-header">Disponibles</div>
          </ng-template>
          <ng-template pTemplate="selectedItem" let-currency>
            <span *ngIf="currency">{{ getCurrencyLabel(currency) }}</span>
            <span *ngIf="!currency">Seleccionar moneda</span>
          </ng-template>
          <ng-template pTemplate="item" let-currency>
            <span>{{ getCurrencyLabel(currency) }}</span>
          </ng-template>
          <ng-template pTemplate="footer">
            <div class="select-footer">
              <p-button
                label="Add New"
                icon="pi pi-plus"
                [text]="true"
                severity="secondary"
                [disabled]="!organizationId"
                (onClick)="openCreateCurrencyDialog()"
              ></p-button>
            </div>
          </ng-template>
        </p-select>
        <small class="hint" *ngIf="!loadingCoreSettings && coreSettings.currencies.length === 0">
          No hay monedas registradas.
        </small>
      </div>
    </p-card>

    <p-card>
      <ng-template pTemplate="title">Companias</ng-template>
      <div class="field">
        <label>Compania</label>
        <p-select
          class="w-full"
          [options]="coreSettings.companies"
          [(ngModel)]="selectedCompany"
          optionLabel="name"
          [showClear]="true"
          [filter]="true"
          placeholder="Seleccionar compania"
          appendTo="body"
        >
          <ng-template pTemplate="dropdownicon">
            <i class="pi pi-briefcase"></i>
          </ng-template>
          <ng-template pTemplate="header">
            <div class="select-header">Disponibles</div>
          </ng-template>
          <ng-template pTemplate="selectedItem" let-company>
            <div class="option-item" *ngIf="company">
              <div class="option-title">{{ company.name }}</div>
              <small class="option-meta">{{ getCompanyCountryLabel(company) }}</small>
            </div>
            <span *ngIf="!company">Seleccionar compania</span>
          </ng-template>
          <ng-template pTemplate="item" let-company>
            <div class="option-item">
              <div class="option-title">{{ company.name }}</div>
              <small class="option-meta">{{ getCompanyCountryLabel(company) }}</small>
            </div>
          </ng-template>
          <ng-template pTemplate="footer">
            <div class="select-footer">
              <p-button
                label="Add New"
                icon="pi pi-plus"
                [text]="true"
                severity="secondary"
                [disabled]="!organizationId || coreSettings.countries.length === 0"
                (onClick)="openCreateCompanyDialog()"
              ></p-button>
            </div>
          </ng-template>
        </p-select>
        <small class="hint" *ngIf="!loadingCoreSettings && coreSettings.companies.length === 0">
          No hay companias registradas.
        </small>
      </div>
    </p-card>
  </div>

  <div class="actions">
      <p-button
        label="Guardar y continuar"
        icon="pi pi-arrow-right"
        [disabled]="!organizationId"
        (onClick)="saveAndContinue()"
      ></p-button>
    </div>
</div>

<p-dialog header="Agregar pais" [(visible)]="createCountryDialogOpen" [modal]="true" [style]="{ width: '460px' }">
  <form [formGroup]="createCountryForm" class="dialog-form">
    <label>Codigo</label>
    <input pInputText formControlName="code" />

    <label>Nombre</label>
    <input pInputText formControlName="name" />
  </form>
  <ng-template pTemplate="footer">
    <p-button label="Cancelar" [text]="true" (onClick)="createCountryDialogOpen=false"></p-button>
    <p-button label="Guardar" icon="pi pi-check" (onClick)="saveCountry()"></p-button>
  </ng-template>
</p-dialog>

<p-dialog header="Agregar moneda" [(visible)]="createCurrencyDialogOpen" [modal]="true" [style]="{ width: '460px' }">
  <form [formGroup]="createCurrencyForm" class="dialog-form">
    <label>Codigo</label>
    <input pInputText formControlName="code" />

    <label>Nombre</label>
    <input pInputText formControlName="name" />

    <label>Simbolo</label>
    <input pInputText formControlName="symbol" />
  </form>
  <ng-template pTemplate="footer">
    <p-button label="Cancelar" [text]="true" (onClick)="createCurrencyDialogOpen=false"></p-button>
    <p-button label="Guardar" icon="pi pi-check" (onClick)="saveCurrency()"></p-button>
  </ng-template>
</p-dialog>

<p-dialog header="Crear compania" [(visible)]="createCompanyDialogOpen" [modal]="true" [style]="{ width: '460px' }">
  <form [formGroup]="createCompanyForm" class="dialog-form">
    <label>Nombre</label>
    <input pInputText formControlName="name" />

    <label>Pais</label>
    <p-select
      [options]="coreSettings.countries"
      optionLabel="name"
      optionValue="id"
      formControlName="countryId"
      appendTo="body"
      placeholder="Seleccionar pais"
    >
      <ng-template pTemplate="item" let-country>
        <span>{{ getCountryLabel(country) }}</span>
      </ng-template>
    </p-select>

    <label>Moneda base</label>
    <p-select
      [options]="coreSettings.currencies"
      optionLabel="name"
      optionValue="id"
      formControlName="baseCurrencyId"
      appendTo="body"
      placeholder="Seleccionar moneda"
    >
      <ng-template pTemplate="item" let-currency>
        <span>{{ getCurrencyLabel(currency) }}</span>
      </ng-template>
    </p-select>
  </form>
  <ng-template pTemplate="footer">
    <p-button label="Cancelar" [text]="true" (onClick)="createCompanyDialogOpen=false"></p-button>
    <p-button label="Guardar" icon="pi pi-check" (onClick)="createCompany()"></p-button>
  </ng-template>
</p-dialog>
